<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Geometry Dash Lite</title>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js"></script>
<style>
body {margin:0; overflow:hidden; background:linear-gradient(90deg,#0f0c29,#302b63,#24243e); display:flex; justify-content:center; align-items:center; height:100vh; font-family:Arial, sans-serif; color:white;}
#login{text-align:center;}
#googleBtn{display:flex; align-items:center; justify-content:center; background:white; color:#444; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; font-size:16px; font-weight:bold; transition:0.3s;}
#googleBtn img{height:20px; margin-right:8px;}
#googleBtn:hover{background:#eee;}
#game{display:none; width:800px; height:250px; background:#222; border:3px solid #555; border-radius:10px; position:relative; overflow:hidden;}
#player{width:30px; height:30px; background:yellow; position:absolute; bottom:0; left:50px; border-radius:5px;}
.obstacle{width:30px; height:50px; background:red; position:absolute; bottom:0; right:-40px; animation:move 3s linear forwards;}
@keyframes move{from{right:-40px;}to{right:820px;}}
#score{position:absolute; top:10px; left:10px; font-size:20px; font-weight:bold;}
#gameover{position:absolute; top:40%; left:50%; transform:translate(-50%, -50%); font-size:30px; font-weight:bold; display:none; color:#ff4444;}
</style>
</head>
<body>

<div id="login">
<h1>Вход в Geometry Dash Lite</h1>
<button id="googleBtn">
<img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
Войти через Google
</button>
</div>

<div id="game">
<div id="player"></div>
<div id="score">Очки: 0</div>
<div id="gameover">Игра окончена! Нажми Enter для рестарта</div>
</div>

<audio id="bgm" loop>
<source src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg" type="audio/ogg">
</audio>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyC8lcLregxdwR6GBSrkMqlWoZNdUuU3jdM",
  authDomain: "chat-ca735.firebaseapp.com",
  projectId: "chat-ca735",
  storageBucket: "chat-ca735.firebasestorage.app",
  messagingSenderId: "407446630782",
  appId: "1:407446630782:web:db7293a24c6e6445ebc32f"
};

const app = firebase.initializeApp(firebaseConfig);
const auth = firebase.getAuth(app);

const loginDiv = document.getElementById("login");
const gameDiv = document.getElementById("game");
const googleBtn = document.getElementById("googleBtn");

// Вход через Redirect
googleBtn.addEventListener("click", () => {
  const provider = new firebase.GoogleAuthProvider();
  firebase.signInWithRedirect(auth, provider);
});

// Обработка редиректа после входа
firebase.getRedirectResult(auth)
.then((result)=>{
  if(result.user){
    console.log("Вошёл:", result.user.displayName);
    loginDiv.style.display = "none";
    gameDiv.style.display = "block";
    startGame();
  }
})
.catch((error)=>{console.log("Ошибка входа:", error);});

// --- Игра ---
function startGame(){
const player=document.getElementById("player");
const scoreElement=document.getElementById("score");
const gameOverText=document.getElementById("gameover");
const bgm=document.getElementById("bgm");
let jumping=false, alive=true, score=0;

function jump(){if(jumping||!alive)return; jumping=true; let pos=0; const up=setInterval(()=>{
if(pos>=100){clearInterval(up); const down=setInterval(()=>{if(pos<=0){clearInterval(down); jumping=false;} else {pos-=5; player.style.bottom=pos+"px";}},20);} else {pos+=5; player.style.bottom=pos+"px";}},20);}

function spawnObstacle(){if(!alive) return; const obstacle=document.createElement("div"); obstacle.classList.add("obstacle"); gameDiv.appendChild(obstacle);
const checkCollision=setInterval(()=>{const playerRect=player.getBoundingClientRect(); const obstacleRect=obstacle.getBoundingClientRect();
if(playerRect.right>obstacleRect.left && playerRect.left<obstacleRect.right && playerRect.bottom>obstacleRect.top){
alive=false; bgm.pause(); gameOverText.style.display="block"; clearInterval(checkCollision);
}},10);
obstacle.addEventListener("animationend",()=>{obstacle.remove(); if(alive){score++; scoreElement.textContent="Очки: "+score;}});
setTimeout(spawnObstacle, Math.random()*2000+1000);}

document.addEventListener("keydown",(e)=>{if(e.code==="Space"){jump();} if(e.code==="Enter" && !alive){location.reload();}});
bgm.play().catch(()=>console.log("Музыка включится при клике."));
spawnObstacle();
}
</script>
</body>
</html>